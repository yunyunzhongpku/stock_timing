# è‚¡æŒ‡æ‹©æ—¶ç­–ç•¥ç³»ç»Ÿ

**é¡¹ç›®ç®€ä»‹**: åŸºäºä¸­è¯å…¨æŒ‡(000985.CSI)çš„è‚¡æŒ‡æ‹©æ—¶å› å­åº“ï¼Œé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•åˆ°å…¶ä»–èµ„äº§ã€‚

**é¡¹ç›®çŠ¶æ€**: 2025-10-04 é‡æ„å®Œæˆ
- âœ… ç­–ç•¥3ï¼ˆä¸‰è§’å½¢çªç ´ï¼‰ï¼šæœ‰æ•ˆï¼Œå¯å®æˆ˜åº”ç”¨
- âŒ ç­–ç•¥1ï¼ˆä¸‹è·Œåå¼¹ï¼‰ï¼šå·²åœæ­¢ï¼ˆè¯¦è§æ–‡æ¡£ï¼‰
- ğŸ“‹ ç­–ç•¥2ï¼ˆé¡¶éƒ¨åˆ‡æ¢ï¼‰ï¼šè§„åˆ’ä¸­

---

## ğŸ¯ æ ¸å¿ƒç‰¹ç‚¹

### 1. ç§‘å­¦è¯šå®
- å¯¹"å¥½ç»“æœ"ä¿æŒæ‰¹åˆ¤æ€§æ€€ç–‘
- Out-of-sampleéªŒè¯ï¼ˆæ—¶é—´åˆ†å‰²ï¼‰
- è¯šå®æŠ¥å‘Šæµ‹è¯•æœŸç»“æœ

### 2. æ¨¡å—åŒ–è®¾è®¡
- **factors/**: çº¯å› å­æ¨¡å—ï¼Œæ˜“äºå¤ç”¨
- **backtest/**: é€šç”¨å›æµ‹å·¥å…·
- **examples/**: å®Œæ•´ç¤ºä¾‹å’Œæ¨¡æ¿

### 3. å¯æ‰©å±•æ€§
- æ–°å¢å› å­åªéœ€å®ç°`generate_signals()`
- è‡ªåŠ¨ç»§æ‰¿å®Œæ•´å›æµ‹å’Œå¯è§†åŒ–èƒ½åŠ›
- æ”¯æŒä»»ä½•OHLCæ•°æ®æº

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
Stock_Timing/
â”œâ”€â”€ factors/                     # ç­–ç•¥å› å­æ¨¡å—
â”‚   â”œâ”€â”€ triangle_breakout.py    # âœ… ä¸‰è§’å½¢çªç ´ï¼ˆæœ‰æ•ˆï¼‰
â”‚   â””â”€â”€ decline_rebound.py      # âŒ ä¸‹è·Œåå¼¹ï¼ˆå·²åœæ­¢ï¼‰
â”‚
â”œâ”€â”€ backtest/                    # å›æµ‹åˆ†æå·¥å…·
â”‚   â”œâ”€â”€ indicators.py           # æŠ€æœ¯æŒ‡æ ‡ï¼ˆATRç­‰ï¼‰
â”‚   â”œâ”€â”€ signal_analyzer.py      # é€šç”¨å›æµ‹åˆ†æå™¨
â”‚   â””â”€â”€ visualizer.py           # æ ‡å‡†åŒ–å¯è§†åŒ–
â”‚
â”œâ”€â”€ data/                        # æ•°æ®åŠ è½½æ¨¡å—
â”‚   â””â”€â”€ loader.py               # ç»Ÿä¸€æ•°æ®æ¥å£ï¼ˆWind/æ¼”ç¤ºæ•°æ®ï¼‰
â”‚
â”œâ”€â”€ examples/                    # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”œâ”€â”€ run_csi_all_index.py    # å®Œæ•´åˆ†æç¤ºä¾‹
â”‚   â”œâ”€â”€ template_custom_asset.py # è‡ªå®šä¹‰èµ„äº§æ¨¡æ¿
â”‚   â””â”€â”€ README.md               # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”‚   â””â”€â”€ FACTOR_RESEARCH_SUMMARY.md  # å®Œæ•´ç ”ç©¶æ€»ç»“
â”‚
â”œâ”€â”€ reports/                     # å†å²æŠ¥å‘Šï¼ˆå›¾è¡¨ï¼‰
â”‚   â”œâ”€â”€ strategy1/              # ç­–ç•¥1ç›¸å…³å›¾è¡¨
â”‚   â””â”€â”€ strategy3/              # ç­–ç•¥3ç›¸å…³å›¾è¡¨
â”‚
â”œâ”€â”€ config.py                    # ç»Ÿä¸€é…ç½®ç®¡ç†
â”œâ”€â”€ verify_refactoring.py        # é‡æ„éªŒè¯è„šæœ¬
â”œâ”€â”€ data_loader.py               # æ—§ç‰ˆæ•°æ®åŠ è½½å™¨ï¼ˆå¾…åºŸå¼ƒï¼‰
â””â”€â”€ requirements.txt             # ä¾èµ–åŒ…
```

---

## âš¡ å¿«é€Ÿå¼€å§‹

### æœ€ç®€ç¤ºä¾‹ï¼ˆ3è¡Œä»£ç ï¼‰

```python
from data.loader import load_csi_all_index
from factors.triangle_breakout import generate_signals
from backtest.signal_analyzer import analyze_signals, print_analysis_summary
from config import get_strategy_parameters, get_holding_periods

# 1. åŠ è½½æ•°æ®
data = load_csi_all_index('2013-01-01', '2025-04-30')

# 2. ç”Ÿæˆä¿¡å·
params = get_strategy_parameters('triangle_breakout', preset='basic')
signals = generate_signals(data, **params)

# 3. å›æµ‹åˆ†æ
results = analyze_signals(data, signals,
                         holding_periods=get_holding_periods(),
                         direction='bidirectional')

# 4. æ‰“å°ç»“æœ
print_analysis_summary(results)
```

### è¿è¡Œå®Œæ•´ç¤ºä¾‹

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œä¸­è¯å…¨æŒ‡åˆ†æï¼ˆå«æ—¶é—´åˆ†å‰²éªŒè¯ï¼‰
python examples/run_csi_all_index.py

# ä½¿ç”¨è‡ªå®šä¹‰èµ„äº§ï¼ˆä¿®æ”¹tickeråè¿è¡Œï¼‰
python examples/template_custom_asset.py

# éªŒè¯é‡æ„ï¼ˆç¡®ä¿ä¸åŸå§‹ç‰ˆæœ¬ä¸€è‡´ï¼‰
python verify_refactoring.py
```

---

## ğŸ“Š ç­–ç•¥æ¦‚è§ˆ

### âœ… ç­–ç•¥3ï¼šä¸‰è§’å½¢çªç ´ï¼ˆæœ‰æ•ˆï¼‰

**æ ¸å¿ƒé€»è¾‘**: æ”¶æ•› + çªç ´ + åŒºé—´æ”¶çª„çš„ä¸‰é‡æ¡ä»¶

```python
æ ¸å¿ƒæ¡ä»¶ï¼š
1. å‰5æ—¥æ”¶æ•›ï¼šæ¯æ—¥æ¶¨è·Œå¹…ç»å¯¹å€¼ <= 1%
2. å½“æ—¥çªç ´ï¼šæ¶¨è·Œå¹…ç»å¯¹å€¼ > 1%
3. åŒºé—´æ”¶çª„ï¼šæœ€è¿‘2æ—¥åŒºé—´ < å‰3æ—¥åŒºé—´ * 0.8
```

**å›æµ‹è¡¨ç°**ï¼ˆbasicç‰ˆæœ¬ï¼Œ2013-2025ï¼‰:

| æŒæœ‰æœŸ | å¹³å‡æ”¶ç›Š | èƒœç‡ | på€¼ | æ˜¾è‘—æ€§ |
|--------|----------|------|------|--------|
| 20æ—¥ | **+1.96%** | **65.4%** | **0.0165** | **æ˜¯** |
| 40æ—¥ | +2.01% | 63.5% | 0.0908 | å¦ |

**æ—¶é—´åˆ†å‰²éªŒè¯**ï¼ˆ2022-01-01åˆ†å‰²ï¼‰:
- è®­ç»ƒæœŸï¼ˆ2013-2021ï¼‰ï¼š38ä¿¡å·ï¼Œ20æ—¥+2.19%ï¼Œp=0.0255 âœ…
- æµ‹è¯•æœŸï¼ˆ2022-2025ï¼‰ï¼š14ä¿¡å·ï¼Œ20æ—¥+1.33%ï¼Œp=0.3877 âš ï¸

**ç»“è®º**: è®­ç»ƒæœŸæ˜¾è‘—ï¼Œæµ‹è¯•æœŸæ ·æœ¬é‡å°æœªè¾¾æ˜¾è‘—æ€§ï¼Œ**ç»§ç»­è§‚å¯Ÿï¼Œè°¨æ…åº”ç”¨**

---

### âŒ ç­–ç•¥1ï¼šä¸‹è·Œåå¼¹ï¼ˆå·²åœæ­¢ï¼‰

**åœæ­¢æ—¥æœŸ**: 2025-10-04
**åœæ­¢åŸå› **: ç»æ‰¹åˆ¤æ€§åˆ†æï¼Œå‘ç°éªŒè¯æ–¹æ³•å­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜
- æ‰€æœ‰éªŒè¯å‡ä¸ºin-sampleæµ‹è¯•
- éªŒè¯æ•°æ®å¯èƒ½å¾ªç¯è®ºè¯
- æ ¸å¿ƒæŒ‡æ ‡"40æ—¥å†…æœ€é«˜æ”¶ç›Š"ä¸å¯æ“ä½œ
- è¡¥å……ç¦»åœºæœºåˆ¶ä¼šé™·å…¥è¿‡æ‹Ÿåˆé™·é˜±

**æ•™å­¦ä»·å€¼**: ä½œä¸ºæ¡ˆä¾‹å±•ç¤ºå¦‚ä½•ä¿æŒç§‘å­¦è¯šå®ï¼Œå¦‚ä½•è¯†åˆ«å’Œé¿å…æ–¹æ³•è®ºé™·é˜±

**è¯¦è§**: `docs/FACTOR_RESEARCH_SUMMARY.md` - ç­–ç•¥1å®Œæ•´åœæ­¢å†³ç­–è®°å½•

---

### ğŸ“‹ ç­–ç•¥2ï¼šé¡¶éƒ¨åˆ‡æ¢ï¼ˆè§„åˆ’ä¸­ï¼‰

**æ€è·¯**: è¡Œä¸šå®½åº¦éª¤é™ + æŒ‡æ•°åŒæ­¥èµ°å¼±

**æ¡ä»¶**:
- è¡Œä¸šå®½åº¦éª¤é™ï¼šå‰ä¸€æ—¥æ–°é«˜è¡Œä¸šæ•°â‰¥3 ä¸”å½“æ—¥å‡å°‘â‰¥3
- æŒ‡æ•°åŒæ­¥èµ°å¼±ï¼šå½“æ—¥ä¸­è¯å…¨æŒ‡è·Œå¹… â‰¤ -ATR60

**çŠ¶æ€**: åˆ¤å®šæ¡†æ¶æ˜ç¡®ï¼Œå°šæœªè½åœ°ä»£ç 

---

## ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯

### ATRåŠ¨æ€é˜ˆå€¼çº å

```python
if ATR60 < 1%:
    correction = sqrt(ATR60 / 1%)    # ä½æ³¢åŠ¨ï¼šç¼©å°é˜ˆå€¼
elif ATR60 > 2%:
    correction = sqrt(ATR60 / 2%)    # é«˜æ³¢åŠ¨ï¼šæ”¾å¤§é˜ˆå€¼
else:
    correction = 1.0                 # æ­£å¸¸ï¼šä¸å˜

adjusted_decline = -5% * correction
adjusted_rebound = 0.5% * correction
```

### åŒå‘äº¤æ˜“é€»è¾‘

```python
if breakout_direction == 'up':
    # å‘ä¸Šçªç ´ â†’ åšå¤š â†’ ä»·æ ¼ä¸Šæ¶¨ä¸ºæ­£æ”¶ç›Š
    returns = (future_prices / base_price - 1) * 100
else:
    # å‘ä¸‹çªç ´ â†’ åšç©º â†’ ä»·æ ¼ä¸‹è·Œä¸ºæ­£æ”¶ç›Š
    returns = (base_price / future_prices - 1) * 100
```

---

## ğŸ“š æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- **`docs/FACTOR_RESEARCH_SUMMARY.md`**: å®Œæ•´ç ”ç©¶æ€»ç»“
  - ç­–ç•¥1åœæ­¢å†³ç­–è®°å½•
  - ç­–ç•¥3å®Œæ•´å›æµ‹ç»“æœ
  - æ ¸å¿ƒæ•™è®­å’Œæ–¹æ³•è®º
  - é‡æ„è¯´æ˜

- **`examples/README.md`**: è¯¦ç»†ä½¿ç”¨æŒ‡å—
  - å¿«é€Ÿå¼€å§‹
  - å®Œæ•´ç¤ºä¾‹
  - è‡ªå®šä¹‰èµ„äº§æ¨¡æ¿
  - å¸¸è§é—®é¢˜

- **`CLAUDE.md`**: é¡¹ç›®æŒ‡å¯¼æ–‡æ¡£ï¼ˆç»™AIåŠ©æ‰‹ï¼‰

### å†å²æŠ¥å‘Š
- `reports/strategy1/`: ç­–ç•¥1å›¾è¡¨ï¼ˆå†å²è®°å½•ï¼‰
- `reports/strategy3/`: ç­–ç•¥3å›¾è¡¨ï¼ˆå†å²è®°å½•ï¼‰

---

## ğŸ“ æ ¸å¿ƒæ•™è®­

### 1. éªŒè¯æ–¹æ³•è®º
- âœ… æ•°æ®åˆ†å‰²å¿…é¡»åœ¨å¼€å§‹å°±åšå¯¹
- âœ… Out-of-sampleéªŒè¯æ˜¯å¿…é¡»çš„
- âœ… å¯¹"å¥½ç»“æœ"ä¿æŒæ‰¹åˆ¤æ€§æ€€ç–‘

### 2. å›æµ‹æŒ‡æ ‡
- âœ… ä½¿ç”¨å¯æ“ä½œæŒ‡æ ‡ï¼ˆå›ºå®šæŒæœ‰æœŸï¼‰
- âŒ é¿å…è™šå‡æŒ‡æ ‡ï¼ˆ40æ—¥å†…æœ€é«˜ï¼‰

### 3. ç§‘å­¦è¯šå®
```
ç§‘å­¦è¯šå® > è¡¨é¢æˆåŠŸ
åŠæ—¶æ­¢æŸ > æ²‰æ²¡æˆæœ¬
è®¤è¯†å±€é™ > ç›²ç›®è‡ªä¿¡
```

---

## ğŸ”§ æ‰©å±•åˆ°å…¶ä»–èµ„äº§

### æ–¹æ³•1ï¼šä½¿ç”¨æ¨¡æ¿

1. æ‰“å¼€`examples/template_custom_asset.py`
2. ä¿®æ”¹é…ç½®ï¼š
   ```python
   TICKER = '000300.SH'      # æ”¹ä¸ºä½ çš„èµ„äº§ä»£ç 
   ASSET_NAME = 'æ²ªæ·±300'     # æ”¹ä¸ºèµ„äº§åç§°
   ```
3. è¿è¡Œï¼š`python examples/template_custom_asset.py`

### æ–¹æ³•2ï¼šä»CSVåŠ è½½

```python
import pandas as pd
from factors.triangle_breakout import generate_signals

# åŠ è½½CSVæ•°æ®
data = pd.read_csv('your_data.csv', index_col='date', parse_dates=True)
data = data[['open', 'high', 'low', 'close']]

# ç”Ÿæˆä¿¡å·
signals = generate_signals(data,
                          convergence_threshold=0.01,
                          breakout_threshold=0.01,
                          narrowing_ratio=0.8)
```

---

## âš™ï¸ ä¾èµ–ç¯å¢ƒ

- **Python**: 3.11+
- **æ ¸å¿ƒä¾èµ–**: pandas, numpy, matplotlib, scipy
- **å¯é€‰ä¾èµ–**: WindPyï¼ˆçœŸå®æ•°æ®ï¼‰, pytestï¼ˆæµ‹è¯•ï¼‰

**å®‰è£…**:
```bash
pip install -r requirements.txt
```

---

## ğŸ”¬ éªŒè¯ä¸æµ‹è¯•

### é‡æ„éªŒè¯

ç¡®ä¿é‡æ„åä»£ç ä¸åŸå§‹ç‰ˆæœ¬äº§ç”Ÿä¸€è‡´ç»“æœï¼š

```bash
python verify_refactoring.py
```

**éªŒè¯å†…å®¹**:
- âœ… Strategy3ä¿¡å·ç”Ÿæˆï¼šå®Œå…¨ä¸€è‡´
- âœ… å›æµ‹åˆ†æï¼šè¿è¡Œæ­£å¸¸

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç­–ç•¥3ï¼ˆä¸‰è§’å½¢çªç ´ï¼‰

**ä¿¡å·é¢‘ç‡**: å¹´å‡11ä¸ªï¼ˆ2013-2025ï¼‰
**æ–¹å‘åˆ†å¸ƒ**: ä¸Šç ´42%, ä¸‹ç ´58%

**å…¨æ ·æœ¬è¡¨ç°**:
- 20æ—¥æŒæœ‰: +1.96%, èƒœç‡65.4%, p=0.0165 âœ…

**æ—¶é—´åˆ†å‰²éªŒè¯**:
- è®­ç»ƒæœŸ: +2.19%, p=0.0255 âœ…
- æµ‹è¯•æœŸ: +1.33%, p=0.3877 âš ï¸ï¼ˆæ ·æœ¬é‡å°ï¼‰

---

## ğŸ—ºï¸ è·¯çº¿å›¾

### é«˜ä¼˜å…ˆçº§
- [ ] åœ¨å…¶ä»–å¸‚åœº/èµ„äº§ä¸Šæµ‹è¯•ç­–ç•¥3
- [ ] å¼€å‘ç­–ç•¥2ï¼ˆé¡¶éƒ¨åˆ‡æ¢ï¼‰
- [ ] è¡¥å……å•å…ƒæµ‹è¯•
- [ ] Windæ•°æ®CSVç¼“å­˜

### ä¸­ä¼˜å…ˆçº§
- [ ] è½»é‡çº§å›æµ‹å¼•æ“ï¼ˆå«æ­¢ç›ˆæ­¢æŸï¼‰
- [ ] ä¿¡å·è´¨é‡è¯„åˆ†ç³»ç»Ÿ
- [ ] æ—¥å¿—ä¸å‘Šè­¦è§„èŒƒ

### ä½ä¼˜å…ˆçº§
- [ ] å¤šç­–ç•¥ç»„åˆæ¡†æ¶
- [ ] å®ç›˜éªŒè¯å‡†å¤‡
- [ ] ruff/mypyä»£ç è´¨é‡å·¥å…·

---

## ğŸ’¡ è´¡çŒ®

æœ¬é¡¹ç›®é‡‡ç”¨ç§‘å­¦è¯šå®åŸåˆ™ï¼š
- è¯šå®æŠ¥å‘Šæ‰€æœ‰ç»“æœï¼ˆå¥½åéƒ½æ¥å—ï¼‰
- ä¸¥æ ¼çš„éªŒè¯æ–¹æ³•è®º
- ä¿æŒå¯¹"å¥½ç»“æœ"çš„æ‰¹åˆ¤æ€§æ€€ç–‘

å¦‚æœæ‚¨å‘ç°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿æIssueã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ç”¨äºç ”ç©¶å’Œæ•™å­¦ç›®çš„ã€‚ä½¿ç”¨æœ¬é¡¹ç›®çš„ç­–ç•¥è¿›è¡Œå®ç›˜äº¤æ˜“ï¼Œé£é™©è‡ªè´Ÿã€‚

---

## ğŸ† æˆæœæ€»ç»“

### æˆåŠŸçš„éƒ¨åˆ†
- âœ… å®Œæ•´çš„æ¨¡å—åŒ–æ¡†æ¶
- âœ… ä¸¥æ ¼çš„éªŒè¯æ–¹æ³•è®º
- âœ… ç­–ç•¥3ï¼ˆä¸‰è§’å½¢çªç ´ï¼‰æœ‰æ•ˆ
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹

### è¯šå®çš„éƒ¨åˆ†
- âŒ ç­–ç•¥1åœæ­¢ï¼ˆæ–¹æ³•è®ºé—®é¢˜ï¼‰
- âš ï¸ ç­–ç•¥3æµ‹è¯•æœŸæœªè¾¾æ˜¾è‘—æ€§
- ğŸ’¡ ä¿æŒç§‘å­¦è¯šå®ï¼Œç»§ç»­è§‚å¯Ÿ

### æ•™å­¦ä»·å€¼
- å±•ç¤ºå®Œæ•´çš„é‡åŒ–ç­–ç•¥å¼€å‘æµç¨‹
- å±•ç¤ºå¦‚ä½•è¯†åˆ«å’Œé¿å…æ–¹æ³•è®ºé™·é˜±
- å±•ç¤ºç§‘å­¦è¯šå®çš„é‡è¦æ€§

---

**æœ€åæ›´æ–°**: 2025-10-04
**é¡¹ç›®çŠ¶æ€**: é‡æ„å®Œæˆï¼Œå¯ç”¨äºç ”ç©¶å’Œæ‰©å±•

---

**æ ¸å¿ƒä»·å€¼è§‚**:
> åœ¨é‡åŒ–äº¤æ˜“ä¸­ï¼Œ"ä¸çŸ¥é“"æ¯”"é”™è¯¯çš„ç¡®å®š"æ›´è¯šå®ã€‚
